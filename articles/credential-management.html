<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Credential Management • glamr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Credential Management">
<meta property="og:description" content="Handling USAID/SI credentials
">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">glamr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>

  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/credential-management.html">Credential Management</a>
    </li>
    <li>
      <a href="../articles/project-workflow.html">Project Workflow</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/USAID-OHA-SI/glamr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Credential Management</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/USAID-OHA-SI/glamr/blob/main/vignettes/credential-management.Rmd" class="external-link"><code>vignettes/credential-management.Rmd</code></a></small>
      <div class="hidden name"><code>credential-management.Rmd</code></div>

    </div>

    
    
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>This vignette provides best practices for credential management to
improve the ease and portability of code across analysts.</p>
<p>With access to data PEPFAR’s DATIM, USAID Google Drive, and, the
USAID’s Data Development Commons, analysts have different credentials to
all these systems. Passwords should never be stored in scripts and its
best not to include user names as well. Using <code>glamr</code> will
systematize USAID analysts code. User names will be called the same
thing and will be stored in the same location across machines.</p>
<p>Let’s go through an example of how this might be used, staring by
loading the packages we’ll need.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/USAID-OHA-SI/glamr" class="external-link">glamr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="store-credentials">Store credentials<a class="anchor" aria-label="anchor" href="#store-credentials"></a>
</h3>
<p>Before using credentials you’ll need to store then on your local OS.
The <code>glamr</code> package utilize <code>keyring</code> to store and
access the usernames and passwords, using some wrappers around
<code>keyring</code> functions.</p>
<p>Let’s start by storing our USAID email address, which we will use to
access Google Drive. You’ll only be storing your email, not password.
This function also allows you to store your email in your .Rprofile,
allowing <code><a href="https://googledrive.tidyverse.org/reference/drive_auth.html" class="external-link">googledrive::drive_auth()</a></code> and
<code><a href="https://googlesheets4.tidyverse.org/reference/gs4_auth.html" class="external-link">googlesheets4::gs4_auth()</a></code> to run without you having to
enter your email.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_email.html">set_email</a></span><span class="op">(</span><span class="st">"rshah@usaid.gov"</span><span class="op">)</span></span></code></pre></div>
<p>Next up we’ll store our DATIM credentials. For this, you’ll need to
enter you DATIM user name. When you run the code, you will get a
prompt/pop-up window in RStudio to enter your password.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_datim.html">set_datim</a></span><span class="op">(</span><span class="st">"rshah"</span><span class="op">)</span></span></code></pre></div>
<p>Lastly, if you have access to Amazon Web Services (s3) for the DDC,
you can also store your s3 access and secret keys.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">set_s3access</span><span class="op">(</span>access <span class="op">=</span> <span class="st">"ABDCEDFF"</span>, </span>
<span>             secret <span class="op">=</span> <span class="st">"MLIZD998SD"</span><span class="op">)</span></span></code></pre></div>
<p>These functions have now passed your credentials in your operating
system’s credential manager - Credential Store on Windows and Keychain
on MacOS. We can use <code>keyring</code> to see all the “services”, or
accounts, stored there.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">keyring</span><span class="fu">::</span><span class="fu"><a href="https://keyring.r-lib.org/reference/key_get.html" class="external-link">key_list</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="old-way-of-doing-things">Old way of doing things<a class="anchor" aria-label="anchor" href="#old-way-of-doing-things"></a>
</h3>
<p>Without using the <code>glamr</code> package, analysts would have had
to write out their username and authenticate. Prior to saving and
pushing the code to GitHub, the analyst would have to remove their
email. Another analyst would have to review the code and find where to
put their email in manually if running themselves.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://googlesheets4.tidyverse.org" class="external-link">googlesheets4</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#email</span></span>
<span>  <span class="va">email</span> <span class="op">&lt;-</span> <span class="st">"rshah@usaid.gov"</span></span>
<span></span>
<span><span class="co">#authenticate</span></span>
<span>  <span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/gs4_auth.html" class="external-link">gs4_auth</a></span><span class="op">(</span><span class="va">email</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#specific Google Sheet Unique ID (found at the end of the URL)</span></span>
<span>  <span class="va">sheet_id</span> <span class="op">&lt;-</span> <span class="st">'5mD3ndk08Sdd3dn1dm29smD'</span></span>
<span>  </span>
<span><span class="co">#read directly into R (similar to read_csv or read_xlsx)</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/range_read.html" class="external-link">read_sheet</a></span><span class="op">(</span><span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/sheets_id.html" class="external-link">as_sheets_id</a></span><span class="op">(</span><span class="va">sheet_id</span><span class="op">)</span>, <span class="st">"Sheet1"</span><span class="op">)</span></span>
<span>  </span></code></pre></div>
<p>We faced a similar issue with DATIM credentials, where we had to
either write out our username and remove prior to pushing to GitHub or
some analysts stored this information in scripts in different locations
on their different machines, using different object name, eg
<code>user</code>, <code>myuser</code>, <code>datim_acct</code>,
<code>datim_login</code>, etc.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#DATIM user</span></span>
<span>  <span class="va">user</span> <span class="op">&lt;-</span> <span class="st">"rshah"</span></span>
<span></span>
<span><span class="co">#pull DATIM table of OU/country UIDs and sub-national unit levels</span></span>
<span>  <span class="va">ou_table</span> <span class="op">&lt;-</span> <span class="fu">datim_outable</span><span class="op">(</span><span class="va">user</span>, <span class="fu">mypwd</span><span class="op">(</span><span class="va">user</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="accessing-stored-credentials">Accessing stored credentials<a class="anchor" aria-label="anchor" href="#accessing-stored-credentials"></a>
</h3>
<p>The old way of doing things was inefficient and posed a risk of
posting credentials accidentally. The previous method required storing
the username in your code and then using it to pull from an encrypted
local file that stored the password associated with the username using
<code>glamr::mypwd()</code>. Each analyst would have to change the
username if they ran the code. The analyst, now, will perform the same
task, but won’t have to write our their username in the code since its
loaded into the session with <code><a href="../reference/load_secrets.html">load_secrets()</a></code> and always
assigned/called the same thing.</p>
<p>Now that they’re stored after using <code><a href="../reference/set_email.html">set_email()</a></code> and
<code><a href="../reference/set_datim.html">set_datim()</a></code>, we can load up our credentials at the
beginning of our code and be available for your current R session. In
addition to storing your email, <code><a href="../reference/load_secrets.html">load_secrets()</a></code> will
authenticate with Google Drive if you have the <code>googledrive</code>
and/or <code>googlesheets4</code> packages.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/load_secrets.html">load_secrets</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Your account information is stored for the session in
<code>Options</code> and can be accessed directly via
<code>getOptions("email")</code> or <code>getOptions("datim")</code>. We
also have two wrapper functions to pull your DATIM information since you
may need to include that in an API request - <code><a href="../reference/datim_user.html">datim_user()</a></code>
and <code><a href="../reference/datim_pwd.html">datim_pwd()</a></code></p>
<p>How does this help? Instead of having to manually enter your USAID
email, it can be loaded automatically and already authenticated for
Google API by running <code><a href="../reference/load_secrets.html">load_secrets()</a></code>. The user can also
specify which authentication they want to provide in a session, rather
than loading all of them. For example, you could just specify to
authenticate for use with Google Drive and Sheets -
<code>load_secrets("email")</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://googlesheets4.tidyverse.org" class="external-link">googlesheets4</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/USAID-OHA-SI/glamr" class="external-link">glamr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#setup session</span></span>
<span>  <span class="fu"><a href="../reference/load_secrets.html">load_secrets</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#specific Google Sheet Unique ID (found at the end of the URL)</span></span>
<span>  <span class="va">sheet_id</span> <span class="op">&lt;-</span> <span class="st">'5mD3ndk08Sdd3dn1dm29smD'</span></span>
<span></span>
<span><span class="co">#read directly into R (similar to read_csv or read_xlsx)</span></span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/range_read.html" class="external-link">read_sheet</a></span><span class="op">(</span><span class="fu"><a href="https://googlesheets4.tidyverse.org/reference/sheets_id.html" class="external-link">as_sheets_id</a></span><span class="op">(</span><span class="va">sheet_id</span><span class="op">)</span>, <span class="st">"Sheet1"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co">#pull DATIM table of OU/country UIDs and sub-national unit levels</span></span>
<span>  <span class="va">ou_table</span> <span class="op">&lt;-</span> <span class="fu">datim_outable</span><span class="op">(</span><span class="fu"><a href="../reference/datim_user.html">datim_user</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="../reference/datim_pwd.html">datim_pwd</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Aaron Chafetz, Tim Essam, Baboyma Kagniniwa, Benjamin Kasdan.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
